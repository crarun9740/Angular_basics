<div class="todo-app">
  <header class="top">
    <h1>âœ“ Todo Manager</h1>
    <p class="subtitle">Stay organized. Complete your tasks. Track your progress.</p>
  </header>

  <div class="new-todo">
    <input
      aria-label="New todo"
      placeholder="Add a new task..."
      [value]="newTodo()"
      (input)="newTodo.set($any($event.target).value)"
      (keyup.enter)="addTodo()"
    />
    <button class="btn-primary" (click)="addTodo()">Add Task</button>
  </div>

  <!-- Filters + Count -->
  <div class="controls">
    <div class="filters">
      <button [class.active]="filter() === 'all'" (click)="setFilter('all')">All</button>
      <button [class.active]="filter() === 'active'" (click)="setFilter('active')">Pending</button>
      <button [class.active]="filter() === 'completed'" (click)="setFilter('completed')">Done</button>
    </div>
    <div class="counts">{{ remaining() }} remaining</div>
  </div>

  <!-- Todo List -->
  <ul class="list" *ngIf="visible().length > 0; else noTodos">
    <li *ngFor="let item of visible(); let r = index" [class.completed]="item.todo.completed">
      <div class="row">
        <label class="left">
          <input type="checkbox" [checked]="item.todo.completed" (change)="toggle(item.index)" />

          <!-- View Mode -->
          <ng-container *ngIf="editingIndex() !== item.index; else editBlock">
            <span class="title" (dblclick)="startEdit(item.index)">
              {{ item.todo.title }}
            </span>
          </ng-container>

          <!-- Edit Mode -->
          <ng-template #editBlock>
            <input
              class="edit-input"
              [value]="editText()"
              (input)="editText.set($any($event.target).value)"
              (keyup.enter)="saveEdit()"
              (keyup.escape)="cancelEdit()"
              autofocus
            />
          </ng-template>
        </label>

        <div class="actions">
          <button
            class="btn-ghost"
            *ngIf="editingIndex() !== item.index"
            (click)="startEdit(item.index)"
          >
            Edit
          </button>
          <button class="btn-ghost" *ngIf="editingIndex() === item.index" (click)="saveEdit()">
            Save
          </button>
          <button class="delete" (click)="remove(item.index)" aria-label="Delete" title="Delete task">Ã—</button>
        </div>
      </div>
    </li>
  </ul>

  <ng-template #noTodos>
    <div class="empty-message">
      <p>No tasks to show. Add one to get started! ðŸŽ¯</p>
    </div>
  </ng-template>

  <div class="footer">
    <button class="btn-link" (click)="clearCompleted()" *ngIf="hasCompleted()">Clear Completed</button>
  </div>
</div>
